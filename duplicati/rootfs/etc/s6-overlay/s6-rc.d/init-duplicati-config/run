#!/usr/bin/with-contenv bashio
# shellcheck shell=bash
set +e
bashio::log.info "starting init-duplicati-config"

export _TZ=$(bashio::config 'timezone')
export _USR_ID=$(bashio::config 'USR_ID')
export _GRP_ID=$(bashio::config 'GRP_ID')
export _CLI_ARGS=$(bashio::config 'CLI_ARGS')

echo "
----------------------------------------------------------------------
ENVIRONMENT APP
----------------------------------------------------------------------
TZ=${_TZ}
USR_ID=${_USR_ID}
GRP_ID=${_GRP_ID}
CLI_ARGS=${_CLI_ARGS}
----------------------------------------------------------------------
"


# Overhauling userbase
#
echo "root:x:0:root" > /etc/group
echo "root:x:0:0:root:/root:/bin/ash" > /etc/passwd
if [ "$GRP_ID" -ne 0 ]; then
    addgroup -g "$GRP_ID" -S abc;
fi
if [ "$USR_ID" -ne 0 ]; then
    adduser -u "$USR_ID" -S abc -G abc;
fi
 
# Configuring folders and permissions   
# 
chown -R "$USR_ID":"$GRP_ID"   /config
